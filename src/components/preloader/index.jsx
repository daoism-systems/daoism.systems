import React, { useEffect, useLayoutEffect, useState } from "react";
import { useProgress } from "@react-three/drei";

const Preloader = () => {
  const [playAnimation, setPlayAnimation] = useState(false);
  const [octagon, setOctagon] = useState(false);

  const { active, progress, errors, item, loaded, total } = useProgress();

  const percentRef = React.useRef();

  const onPageLoad = () => {
    setPlayAnimation(true);
  };

  useEffect(() => {
    // console.log(active, progress, errors, item, loaded, total);

    if (progress === 100) {
      setTimeout(() => {
        setOctagon(true);
      }, 1000);
      setTimeout(() => {
        onPageLoad();
      }, 2500);
    }

    // animation counter from 0 to 100 with
    // 0.5s delay between each number
    if (progress > 0) {
      let i = 0;
      const timer = setInterval(() => {
        percentRef.current.innerHTML = `${i}%`;
        i++;
        if (i > progress) {
          clearInterval(timer);
        }
      }, 5);
    }
  }, [progress]);

  return (
    <>
      <div className={`preloader ${playAnimation === true ? "hidden" : ""}`}>
        <div className={"preloaderBox"}>
          <div className={"percentage"} ref={percentRef}>
            Loading...
          </div>

          <svg
            className={`${octagon ? "hidden" : null}`}
            width="500"
            height="500"
            viewBox="0 0 500 500"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            {/* 1 */}
            <g id="gramOne">
              <path
                d="M169.663 6.65422C169.663 3.52928 172.196 0.996018 175.321 0.996018H324.681C327.806 0.996018 330.339 3.52928 330.339 6.65423V20.1938C330.339 23.3188 327.806 25.852 324.681 25.852H175.321C172.196 25.852 169.663 23.3188 169.663 20.1938V6.65422Z"
                fill="white"
              />
              <path
                d="M194.519 43.0511C194.519 39.9262 197.052 37.3929 200.177 37.3929H299.825C302.95 37.3929 305.483 39.9262 305.483 43.0511V56.5907C305.483 59.7157 302.95 62.2489 299.825 62.2489H200.177C197.052 62.2489 194.519 59.7157 194.519 56.5907V43.0511Z"
                fill="white"
              />
              <path
                d="M220.261 79.448C220.261 76.3231 222.794 73.7898 225.919 73.7898H274.08C277.205 73.7898 279.738 76.3231 279.738 79.448V92.9876C279.738 96.1126 277.205 98.6458 274.08 98.6458H225.919C222.794 98.6458 220.261 96.1126 220.261 92.9876V79.448Z"
                fill="white"
              />
            </g>

            {/* 2 */}
            <g id="gramTwo">
              <path
                d="M349.24 107.971C351.449 105.761 355.032 105.761 357.242 107.971L366.816 117.545C369.025 119.754 369.025 123.337 366.816 125.547L357.242 135.12C355.032 137.33 351.449 137.33 349.24 135.12L339.666 125.547C337.456 123.337 337.456 119.754 339.666 117.545L349.24 107.971Z"
                fill="white"
              />
              <path
                d="M375.871 133.717C378.081 131.507 381.664 131.507 383.873 133.717L393.447 143.29C395.657 145.5 395.657 149.083 393.447 151.292L383.873 160.866C381.664 163.076 378.081 163.076 375.871 160.866L366.297 151.292C364.088 149.083 364.088 145.5 366.297 143.29L375.871 133.717Z"
                fill="white"
              />
              <path
                d="M407.795 83.5861C405.586 85.7958 402.003 85.7958 399.794 83.5861L354.757 38.5493C352.547 36.3396 352.547 32.7571 354.757 30.5474L364.331 20.9735C366.54 18.7638 370.123 18.7638 372.333 20.9735L417.369 66.0103C419.579 68.2199 419.579 71.8025 417.369 74.0122L407.795 83.5861Z"
                fill="white"
              />
              <path
                d="M469.934 145.727C467.725 147.937 464.142 147.937 461.932 145.727L416.896 100.69C414.686 98.4805 414.686 94.8979 416.896 92.6882L426.47 83.1143C428.679 80.9046 432.262 80.9046 434.472 83.1143L479.508 128.151C481.718 130.361 481.718 133.943 479.508 136.153L469.934 145.727Z"
                fill="white"
              />
              <path
                d="M425.273 152.553C423.063 154.763 419.48 154.763 417.271 152.553L346.768 82.0501C344.558 79.8404 344.558 76.2579 346.768 74.0482L356.342 64.4742C358.551 62.2646 362.134 62.2646 364.344 64.4742L434.847 134.977C437.056 137.187 437.056 140.769 434.847 142.979L425.273 152.553Z"
                fill="white"
              />
            </g>

            {/* 3 */}
            <g id="gramThree">
              <path
                d="M479.806 329.45C476.681 329.45 474.148 326.917 474.148 323.792V176.207C474.148 173.082 476.681 170.549 479.806 170.549H493.346C496.471 170.549 499.004 173.082 499.004 176.207V323.792C499.004 326.917 496.471 329.45 493.346 329.45H479.806Z"
                fill="white"
              />
              <path
                d="M420.554 219.374C423.679 219.374 426.212 221.907 426.212 225.032V238.571C426.212 241.696 423.679 244.23 420.554 244.23H407.015C403.89 244.23 401.356 241.696 401.356 238.571V225.032C401.356 221.907 403.89 219.374 407.015 219.374H420.554Z"
                fill="white"
              />
              <path
                d="M421.442 255.772C424.567 255.772 427.1 258.306 427.1 261.431V274.97C427.1 278.095 424.567 280.628 421.442 280.628H407.902C404.777 280.628 402.244 278.095 402.244 274.97V261.431C402.244 258.306 404.777 255.772 407.902 255.772H421.442Z"
                fill="white"
              />
              <path
                d="M443.409 243.342C440.284 243.342 437.751 240.809 437.751 237.684V201.064C437.751 197.939 440.284 195.406 443.409 195.406H456.949C460.074 195.406 462.607 197.939 462.607 201.064V237.684C462.607 240.809 460.074 243.342 456.949 243.342H443.409Z"
                fill="white"
              />
              <path
                d="M443.409 304.595C440.284 304.595 437.751 302.062 437.751 298.937V262.317C437.751 259.192 440.284 256.659 443.409 256.659H456.949C460.074 256.659 462.607 259.192 462.607 262.317V298.937C462.607 302.062 460.074 304.595 456.949 304.595H443.409Z"
                fill="white"
              />
            </g>

            {/* 4 */}
            <g id="gramFour">
              <path
                d="M348.544 425.416C346.334 423.206 346.334 419.624 348.544 417.414L375.694 390.264C377.903 388.054 381.486 388.054 383.695 390.264L393.269 399.838C395.479 402.048 395.479 405.63 393.269 407.84L366.12 434.99C363.91 437.199 360.327 437.199 358.118 434.99L348.544 425.416Z"
                fill="white"
              />
              <path
                d="M391.152 382.804C388.942 380.594 388.942 377.012 391.152 374.802L418.302 347.652C420.511 345.442 424.094 345.442 426.303 347.652L435.877 357.226C438.087 359.436 438.087 363.018 435.877 365.228L408.728 392.378C406.518 394.587 402.935 394.587 400.726 392.378L391.152 382.804Z"
                fill="white"
              />
              <path
                d="M417.785 408.683C415.576 406.473 415.576 402.891 417.785 400.681L462.822 355.644C465.032 353.435 468.614 353.435 470.824 355.644L480.398 365.218C482.608 367.428 482.608 371.011 480.398 373.22L435.361 418.257C433.151 420.467 429.569 420.467 427.359 418.257L417.785 408.683Z"
                fill="white"
              />
              <path
                d="M355.644 470.826C353.435 468.616 353.435 465.034 355.644 462.824L400.681 417.787C402.891 415.577 406.473 415.577 408.683 417.787L418.257 427.361C420.467 429.571 420.467 433.153 418.257 435.363L373.22 480.4C371.011 482.609 367.428 482.609 365.218 480.4L355.644 470.826Z"
                fill="white"
              />
              <path
                d="M340.553 382.61C338.344 380.401 338.344 376.818 340.553 374.609L374.608 340.554C376.818 338.344 380.4 338.344 382.61 340.554L392.184 350.128C394.394 352.338 394.394 355.92 392.184 358.13L358.129 392.184C355.92 394.394 352.337 394.394 350.127 392.184L340.553 382.61Z"
                fill="white"
              />
            </g>

            {/* 5 */}
            <g id="gramFive">
              <path
                d="M194.519 443.405C194.519 440.28 197.052 437.747 200.177 437.747H238.573C241.698 437.747 244.231 440.28 244.231 443.405V456.945C244.231 460.07 241.698 462.603 238.573 462.603H200.177C197.052 462.603 194.519 460.07 194.519 456.945V443.405Z"
                fill="white"
              />
              <path
                d="M170.548 479.806C170.548 476.681 173.082 474.148 176.207 474.148H238.571C241.696 474.148 244.229 476.681 244.229 479.806V493.346C244.229 496.471 241.696 499.004 238.571 499.004H176.207C173.082 499.004 170.548 496.471 170.548 493.346V479.806Z"
                fill="white"
              />
              <path
                d="M257.546 479.806C257.546 476.681 260.079 474.148 263.204 474.148H325.568C328.693 474.148 331.226 476.681 331.226 479.806V493.346C331.226 496.471 328.693 499.004 325.568 499.004H263.204C260.079 499.004 257.546 496.471 257.546 493.346V479.806Z"
                fill="white"
              />
              <path
                d="M256.658 443.405C256.658 440.28 259.191 437.747 262.316 437.747H300.712C303.837 437.747 306.37 440.28 306.37 443.405V456.945C306.37 460.07 303.837 462.603 300.712 462.603H262.316C259.191 462.603 256.658 460.07 256.658 456.945V443.405Z"
                fill="white"
              />
              <path
                d="M239.459 401.358C242.584 401.358 245.117 403.891 245.117 407.016V420.556C245.117 423.681 242.584 426.214 239.459 426.214H225.92C222.795 426.214 220.261 423.681 220.261 420.556V407.016C220.261 403.891 222.795 401.358 225.92 401.358H239.459Z"
                fill="white"
              />
              <path
                d="M275.854 401.358C278.979 401.358 281.512 403.891 281.512 407.016V420.556C281.512 423.681 278.979 426.214 275.854 426.214H262.315C259.19 426.214 256.656 423.681 256.656 420.556V407.016C256.656 403.891 259.19 401.358 262.315 401.358H275.854Z"
                fill="white"
              />
            </g>

            {/* 6 */}
            <g id="gramSix">
              <path
                d="M31.437 357.422C33.6466 355.212 37.2292 355.212 39.4389 357.422L145.052 463.035C147.262 465.245 147.262 468.827 145.052 471.037L135.478 480.611C133.269 482.82 129.686 482.82 127.476 480.611L21.863 374.997C19.6533 372.788 19.6533 369.205 21.863 366.995L31.437 357.422Z"
                fill="white"
              />
              <path
                d="M142.571 437.101C140.361 439.311 136.779 439.311 134.569 437.101L65.3629 367.895C63.1532 365.685 63.1533 362.103 65.3629 359.893L74.9369 350.319C77.1465 348.109 80.7291 348.109 82.9388 350.319L152.145 419.525C154.355 421.735 154.355 425.318 152.145 427.527L142.571 437.101Z"
                fill="white"
              />
              <path
                d="M135.122 348.35C137.332 350.56 137.332 354.142 135.122 356.352L125.548 365.926C123.339 368.136 119.756 368.136 117.546 365.926L107.972 356.352C105.763 354.142 105.763 350.56 107.972 348.35L117.546 338.776C119.756 336.567 123.339 336.567 125.548 338.776L135.122 348.35Z"
                fill="white"
              />
              <path
                d="M161.754 374.094C163.963 376.304 163.963 379.886 161.754 382.096L152.18 391.67C149.97 393.88 146.388 393.88 144.178 391.67L134.604 382.096C132.394 379.886 132.394 376.304 134.604 374.094L144.178 364.52C146.388 362.311 149.97 362.311 152.18 364.52L161.754 374.094Z"
                fill="white"
              />
            </g>

            {/* 7 */}
            <g id="gramSeven">
              <path
                d="M6.65423 243.342C3.52928 243.342 0.99602 240.809 0.99602 237.684L0.996018 177.096C0.996018 173.971 3.52928 171.437 6.65423 171.437H20.1938C23.3188 171.437 25.852 173.971 25.852 177.096L25.852 237.684C25.852 240.809 23.3188 243.342 20.1938 243.342H6.65423Z"
                fill="white"
              />
              <path
                d="M6.65423 328.56C3.52928 328.56 0.99602 326.027 0.99602 322.902L0.996018 262.314C0.996018 259.189 3.52928 256.655 6.65423 256.655H20.1938C23.3188 256.655 25.852 259.189 25.852 262.314L25.852 322.902C25.852 326.027 23.3188 328.56 20.1938 328.56H6.65423Z"
                fill="white"
              />
              <path
                d="M43.9368 304.595C40.8118 304.595 38.2786 302.062 38.2786 298.937V201.065C38.2786 197.94 40.8118 195.407 43.9368 195.407H57.4764C60.6013 195.407 63.1346 197.94 63.1346 201.065L63.1346 298.937C63.1346 302.062 60.6013 304.595 57.4764 304.595H43.9368Z"
                fill="white"
              />
              <path
                d="M80.3356 278.852C77.2107 278.852 74.6774 276.318 74.6774 273.193V225.033C74.6774 221.908 77.2107 219.375 80.3356 219.375H93.8752C97.0001 219.375 99.5334 221.908 99.5334 225.033V273.193C99.5334 276.318 97.0001 278.852 93.8752 278.852H80.3356Z"
                fill="white"
              />
            </g>

            {/* 8 */}
            <g id="gramEith">
              <path
                d="M21.865 135.48C19.6553 133.27 19.6553 129.688 21.865 127.478L127.478 21.8648C129.688 19.6551 133.271 19.6551 135.48 21.8648L145.054 31.4387C147.264 33.6484 147.264 37.231 145.054 39.4406L39.4409 145.054C37.2312 147.264 33.6486 147.264 31.439 145.054L21.865 135.48Z"
                fill="white"
              />
              <path
                d="M108.86 150.917C106.651 148.708 106.651 145.125 108.86 142.915L142.915 108.861C145.124 106.651 148.707 106.651 150.917 108.861L160.491 118.435C162.7 120.644 162.7 124.227 160.491 126.437L126.436 160.491C124.226 162.701 120.644 162.701 118.434 160.491L108.86 150.917Z"
                fill="white"
              />
              <path
                d="M65.3626 142.755C63.1529 140.545 63.1529 136.963 65.3626 134.753L91.257 108.859C93.4666 106.649 97.0492 106.649 99.2589 108.859L108.833 118.432C111.043 120.642 111.042 124.225 108.833 126.434L82.9385 152.329C80.7288 154.538 77.1462 154.538 74.9365 152.329L65.3626 142.755Z"
                fill="white"
              />
              <path
                d="M108.86 99.2572C106.651 97.0476 106.651 93.465 108.86 91.2553L134.755 65.361C136.964 63.1513 140.547 63.1513 142.757 65.361L152.33 74.9349C154.54 77.1446 154.54 80.7271 152.33 82.9368L126.436 108.831C124.226 111.041 120.644 111.041 118.434 108.831L108.86 99.2572Z"
                fill="white"
              />
            </g>
          </svg>
        </div>
      </div>

      <style jsx>{`
        .preloader {
          position: fixed;
          width: 100%;
          height: 100%;
          z-index: 200;
          background: #000;

          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;

          transition: all ease-out 0.3s;
        }

        .preloaderBox {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          max-width: 20vw;
        }

        .preloader svg {
          position: absolute;
          width: 20vw;
          height: auto;
          transition: all linear 1s;
        }

        .preloader svg path {
          fill: transparent;
          stroke-width: 0.5;
          stroke: #fff;
          fill-opacity: 0;
          animation: draw linear 1s 0.1s forwards;
          opacity: 0.25;
          transition: all linear 0.4s;
        }

        .preloader svg #gramOne path {
          animation-delay: 0.5s;
        }

        .preloader svg #gramTwo path {
          animation-delay: 0.7s;
        }

        .preloader svg #gramThree path {
          animation-delay: 0.9s;
        }

        .preloader svg #gramFour path {
          animation-delay: 1.2s;
        }

        .preloader svg #gramFive path {
          animation-delay: 1.4s;
        }

        .preloader svg #gramSix path {
          animation-delay: 1.6s;
        }

        .preloader svg #gramSeven path {
          animation-delay: 1.9s;
        }

        .preloader svg #gramEith path {
          animation-delay: 2.1s;
        }

        @keyframes draw {
          100% {
            opacity: 1;
          }
        }

        .preloader svg.hidden path {
          fill: #fff;
          fill-opacity: 1;
        }

        .preloader.hidden {
          pointer-events: none;
          visibility: hidden;
          opacity: 0;
        }

        @media only screen and (max-width: 767px) {
          .preloader svg {
            width: 50vw;
          }

          .preloaderBox {
            max-width: 40vw;
          }
        }
      `}</style>
    </>
  );
};

export default Preloader;
